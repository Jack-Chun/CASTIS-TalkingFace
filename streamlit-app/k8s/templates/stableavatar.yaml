apiVersion: v1
kind: Pod
metadata:
  name: ${POD_NAME}
  labels:
    app: gpu-model-runner
    model: stableavatar
    job-id: ${JOB_ID}
spec:
  restartPolicy: Never
  volumes:
    - name: my-volume
      persistentVolumeClaim:
        claimName: persistent-volume
  terminationGracePeriodSeconds: 1
  containers:
    - name: gpu-worker
      image: ${IMAGE}
      env:
        - name: HOME
          value: /data
        - name: PATH
          value: /data/python/bin:/data/stableavatar-venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
        - name: CUDA_VISIBLE_DEVICES
          value: "0"
      command:
        - /bin/bash
        - -c
        - |
          # PLACEHOLDER: StableAvatar talking face generation
          # This template will be updated when the StableAvatar repository is added

          echo "=== StableAvatar Talking Face Generation ==="
          echo "Input Image: ${INPUT_IMAGE}"
          echo "Input Audio: ${INPUT_AUDIO}"
          echo "Output Video: ${OUTPUT_VIDEO}"

          source /data/stableavatar-venv/bin/activate

          cd /data/StableAvatar

          # TODO: Replace with actual StableAvatar inference command
          # python inference.py \
          #   --image "${INPUT_IMAGE}" \
          #   --audio "${INPUT_AUDIO}" \
          #   --output "${OUTPUT_VIDEO}"

          echo "ERROR: StableAvatar model not yet implemented"
          exit 1
      resources:
        limits:
          nvidia.com/gpu: 1
      volumeMounts:
        - name: my-volume
          mountPath: /data
